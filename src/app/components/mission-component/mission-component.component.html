<mat-card
  class="mission-card"
  [class.invalid]="missionForm.invalid && missionForm.touched"
  [class.valid]="isFormValid">
  <mat-card-content>
    <button mat-icon-button color="warn" class="delete-btn" (click)="onRemove()" aria-label="Remove mission">
      <mat-icon>close</mat-icon>
    </button>
    <form [formGroup]="missionForm" class="mission-form">
      <mat-form-field appearance="outline">
        <mat-label>Mission ID</mat-label>
        <input matInput formControlName="missionId" aria-label="Mission ID" />
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>Required UAV Type</mat-label>
        <mat-select formControlName="requiredUAVType" aria-label="Required UAV Type">
          @for (type of uavTypes; track type) {
            <mat-option [value]="type">{{ EnumUtil.getUAVTypeDisplay(type) }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>Priority</mat-label>
        <mat-select formControlName="priority" aria-label="Priority">
          @for (level of priority; track level) {
            <mat-option [value]="level">{{ EnumUtil.getPriorityDisplay(level) }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <fieldset formGroupName="location" class="collapsible-section">
        <legend (click)="toggleLocation()" class="collapsible-legend">
          <mat-icon class="expand-icon">{{ isLocationExpanded() ? 'expand_less' : 'expand_more' }}</mat-icon>
          Location
        </legend>
        @if (isLocationExpanded()) {
          <div class="location-group">
            <mat-form-field appearance="outline">
              <mat-label>Latitude (°)</mat-label>
              <input matInput type="number" formControlName="latitude" aria-label="Latitude" />
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Longitude (°)</mat-label>
              <input matInput type="number" formControlName="longitude" aria-label="Longitude" />
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Altitude (m)</mat-label>
              <input matInput type="number" formControlName="altitude" aria-label="Altitude" />
            </mat-form-field>
          </div>
        }
      </fieldset>

      <fieldset formGroupName="timeWindow" class="collapsible-section">
        <legend (click)="toggleTimeWindow()" class="collapsible-legend">
          <mat-icon class="expand-icon">{{ isTimeWindowExpanded() ? 'expand_less' : 'expand_more' }}</mat-icon>
          Time Window
        </legend>
        @if (isTimeWindowExpanded()) {
          <div class="time-window-content">
            <mat-form-field appearance="outline">
              <mat-label>Start Time</mat-label>
              <input matInput type="datetime-local" formControlName="start" aria-label="Start time" />
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>End Time</mat-label>
              <input matInput type="datetime-local" formControlName="end" aria-label="End time" />
            </mat-form-field>
          </div>
        }
      </fieldset>
    </form>
  </mat-card-content>
</mat-card>
